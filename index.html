<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Prueba Árbol</title>
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.2/dist/aframe-extras.min.js"></script>
</head>

<body style="margin:0; overflow:hidden;">

  <a-scene
    background="color: #7F7F7FFF"
    renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true"
    shadow="type: pcfsoft">

    <!-- Assets -->
    <a-assets>
      <a-asset-item id="tronco" src="assets/tronco.glb"></a-asset-item>
      <a-asset-item id="ramas" src="assets/ramas.glb"></a-asset-item>
      <a-asset-item id="hongos" src="assets/hongos.glb"></a-asset-item>
      <a-asset-item id="tlacuache" src="assets/tlacuache.glb"></a-asset-item>
    </a-assets>

    <!-- Modelos -->
    <a-entity gltf-model="#tronco"
              position="0 0 -3"
              scale="1 1 1">
    </a-entity>

    <a-entity gltf-model="#ramas"
              position="0 0 -3"
              scale="1 1 1">
    </a-entity>

    <a-entity gltf-model="#hongos"
              position="0 0 -3"
              scale="1 1 1">
    </a-entity>

    <!-- Cámara y tlacuache -->
<a-entity id="rig"
  movement-controls="controls: keyboard, nipple; speed: 0.06; acceleration: 20;"
  position="0 0 0">

  <!-- TLACUACHE -->
  <a-entity id="player"
            gltf-model="#tlacuache"
            position="0 0 0"
            animation-mixer="clip: walk; loop: repeat">
  </a-entity>

  <!-- CÁMARA -->
  <a-entity id="cameraYaw" position="0 1.5 0">
    <a-entity id="cameraPitch">
      <a-entity id="cameraBoom" position="0 0 4">
        <a-entity camera></a-entity>
      </a-entity>
    </a-entity>
  </a-entity>

</a-entity>

  </a-scene>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const yaw = document.querySelector('#cameraYaw');
  const pitch = document.querySelector('#cameraPitch');

  let isDragging = false;
  let previousX = 0;
  let previousY = 0;

  let yawRotation = 0;
  let pitchRotation = 0;

  const sensitivity = 0.003;
  const maxPitch = Math.PI / 3;

  function onPointerDown(e) {
    isDragging = true;
    previousX = e.clientX || e.touches[0].clientX;
    previousY = e.clientY || e.touches[0].clientY;
  }

  function onPointerUp() {
    isDragging = false;
  }

  function onPointerMove(e) {
    if (!isDragging) return;

    const clientX = e.clientX || e.touches[0].clientX;
    const clientY = e.clientY || e.touches[0].clientY;

    const deltaX = clientX - previousX;
    const deltaY = clientY - previousY;

    previousX = clientX;
    previousY = clientY;

    yawRotation -= deltaX * sensitivity;
    pitchRotation -= deltaY * sensitivity;

    // Limitar vertical
    pitchRotation = Math.max(-maxPitch, Math.min(maxPitch, pitchRotation));

    yaw.object3D.rotation.y = yawRotation;
    pitch.object3D.rotation.x = pitchRotation;
  }

  window.addEventListener('mousedown', onPointerDown);
  window.addEventListener('mouseup', onPointerUp);
  window.addEventListener('mousemove', onPointerMove);

  window.addEventListener('touchstart', onPointerDown);
  window.addEventListener('touchend', onPointerUp);
  window.addEventListener('touchmove', onPointerMove);

});
</script>
  
</body>

</html>






